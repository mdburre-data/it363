<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mock Appointment Scheduler</title>
</head>
<body style="font-family: Arial, Helvetica, sans-serif;">
  <p><a href="debugging_home.html">Back to Main Page</a></p>
  <h1>Admin Page</h1>
    <p>Welcome, Admin! Use the buttons below to manage the database.</p>
    <h2>Upcoming Appointments</h2>
    <div id="upcomingAppointments"></div>
    <h2>Change Weekly Scheduling Hours</h2>
    <form id="changeHoursForm" method="POST" onsubmit="changeHoursHandler(event)">
      <label for="dayOfWeek">Day of the Week:</label>
      <select id="dayOfWeek" name="dayOfWeek" required>
        <option value="1">Monday</option>
        <option value="2">Tuesday</option>
        <option value="3">Wednesday</option>
        <option value="4">Thursday</option>
        <option value="5">Friday</option>
        <option value="6">Saturday</option>
        <option value="7">Sunday</option>
      </select><br>
      <label for="startTime">Start Time:</label>
      <input type="time" id="startTime" name="startTime" required><br><br>
      <label for="endTime">End Time:</label>
      <input type="time" id="endTime" name="endTime" required><br><br>
      <button type="submit">Submit</button>
    </form>
    <h2>Block Date:</h2>
    <form id="blockDateForm" method="POST" onsubmit="blockDateHandler(event)">
      <label for="blockDate">Date to Block:</label>
      <input type="date" id="blockDate" name="blockDate" required><br><br>
      <button type="submit">Submit</button>
    </form>

    <h2>Unblock Date:</h2>
    <form id="unblockDateForm" method="POST" onsubmit="unblockDateHandler(event)">
      <label for="unblockDate">Date to Unblock:</label>
      <input type="date" id="unblockDate" name="unblockDate" required><br><br>
      <button type="submit">Submit</button>
    </form>

    <h2>Change Daily Hours</h2>
    <form id="changeDailyHoursForm" method="POST" onsubmit="changeDailyHoursHandler(event)">
      <label for="changeHoursDate">Date to Change:</label>
      <input type="date" id="changeHoursDate" name="changeHoursDate" required><br><br>
      <label for="updatedStartTime">Start Time:</label>
      <input type="time" id="updatedStartTime" name="updatedStartTime" required><br><br>
      <label for="updatedEndTime">End Time:</label>
      <input type="time" id="updatedEndTime" name="updatedEndTime" required><br><br>
      <button type="submit">Submit</button>
    </form>

      <div id="changeHoursOutput" style="margin-top:20px;"></div>
    
      <h2>Run PHP Scripts</h2>
      <button onclick="callPhp('display_booked_appointments.php')">Display Booked Appointments</button>
      <button onclick="callPhp('display_hours.php')">Display Scheduling Hours</button>
      <div id="output" style="margin-top:20px;"></div>
</body>
<script>
  // Function to call PHP scripts
  function changeHoursHandler(event) {
    event.preventDefault(); 
    const form = event.target;
    const formData = new FormData(form);
    fetch('change_hours.php', {
      method: 'POST',
      body: formData
    })
    .then(response => response.text())
    .then(data => {
      // Instead of alert, inject result into #changeHoursOutput
      document.getElementById("changeHoursOutput").innerHTML = data;
    })
    .catch(error => {
      document.getElementById("changeHoursOutput").innerHTML = "Error: " + error;
    });
  }

  function changeDailyHoursHandler(event) {
    event.preventDefault(); 
    const form = event.target;
    const formData = new FormData(form);
    fetch('change_daily_hours.php', {
      method: 'POST',
      body: formData
    })
    .then(response => response.text())
    .then(data => {
      // Instead of alert, inject result into #changeHoursOutput
      document.getElementById("changeHoursOutput").innerHTML = data;
    })
    .catch(error => {
      document.getElementById("changeHoursOutput").innerHTML = "Error: " + error;
    });
  }

  function blockDateHandler(event) {
    event.preventDefault(); 
    const form = event.target;
    const formData = new FormData(form);
    fetch('block_date.php', {
      method: 'POST',
      body: formData
    })
    .then(response => response.text())
    .then(data => {
      // Instead of alert, inject result into #changeHoursOutput
      document.getElementById("changeHoursOutput").innerHTML = data;
    })
    .catch(error => {
      document.getElementById("changeHoursOutput").innerHTML = "Error: " + error;
    });
  }

  function unblockDateHandler(event) {
    event.preventDefault(); 
    const form = event.target;
    const formData = new FormData(form);
    fetch('unblock_date.php', {
      method: 'POST',
      body: formData
    })
    .then(response => response.text())
    .then(data => {
      // Instead of alert, inject result into #changeHoursOutput
      document.getElementById("changeHoursOutput").innerHTML = data;
    })
    .catch(error => {
      document.getElementById("changeHoursOutput").innerHTML = "Error: " + error;
    });
  }

  function callPhp(scriptName) {
      fetch(scriptName)
        .then(response => response.text())
        .then(data => {
          // Instead of alert, inject result into #output
          document.getElementById("output").innerHTML = data;
        })
        .catch(error => {
          document.getElementById("output").innerHTML = "Error: " + error;
        });
  }

  // Function to load upcoming appointments on page load
  document.addEventListener("DOMContentLoaded", function() {
    // Generate an array of the next 14 days
    const today = new Date();
    const days = [];
    for (let i = 0; i < 14; i++) {
      const date = new Date(today);
      date.setDate(today.getDate() + i);
      const formattedDate = date.toISOString().split("T")[0]; // YYYY-MM-DD
      days.push({
        date: formattedDate,
        appointments: []
      });
    }

    // Fetch appointment data and merge into the days array
    fetch("get_upcoming_appointments.php")
      .then(response => response.json())
      .then(data => {
        if (Array.isArray(data)) {
          data.forEach(app => {
            // Find matching date in the 14-day array
            const match = days.find(d => d.date === app.app_date);
            if (match) {
              match.appointments.push(app);
            }
          });
        }

        // Build the calendar display
        let calendar = '<div style="display: flex; flex-wrap: wrap; gap: 10px;">';
        days.forEach(day => {
          const dateObj = new Date(day.date);
          const dayLabel = dateObj.toLocaleDateString(undefined, { weekday: "short", month: "short", day: "numeric" });

          calendar += `<div style="border: 1px solid #ccc; padding: 10px; width: 160px; text-align: center; border-radius: 8px;">`;
          calendar += `<strong>${dayLabel}</strong><br><small>${day.date}</small><br>`;

          if (day.appointments.length > 0) {
            calendar += `<hr style="margin:6px 0;">`;
            day.appointments.forEach(app => {
              calendar += `
                <div style="margin-bottom: 5px;">
                  <strong>${app.app_time}</strong><br>
                  ${app.email}<br>
                  <small>${app.reason || ""}</small>
                </div>`;
            });
          } else {
            calendar += `<div style="color: #999;">No appointments</div>`;
          }

          calendar += `</div>`;
        });
        calendar += `</div>`;

        document.getElementById("upcomingAppointments").innerHTML = calendar;
      })
      .catch(error => {
        document.getElementById("upcomingAppointments").innerHTML = "Error: " + error;
      });
  });
</script>
</html>